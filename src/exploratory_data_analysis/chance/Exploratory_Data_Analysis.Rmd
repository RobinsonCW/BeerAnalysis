---
title: "Exploratory Data Analysis"
author: "Chance Robinson"
date: "10/12/2019"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Exploratory Data Analysis

## Library Imports


```{r library-imports, quietely=TRUE, warn.conflicts=FALSE}

library(tidyverse)
library(knitr)
library(kableExtra)

```


## Load the csv data

```{r load-data}

beers <- read.csv("../../../data/Beers.csv", stringsAsFactors=FALSE)
breweries <- read.csv("../../../data/Breweries.csv", stringsAsFactors=FALSE)

```

## Default Output

### Beers


```{r head-beers}

head(beers)
# summary(beers)
# str(beers)

```

#### Data Dictionary

  Column Name      |Type                  |Description
  -----------------|--------------------- |------------------------------------------------
  1.  Name         |    Character	        | Beer name
  2.  Beer_ID      |    Integer 		      | Unique identifier for beer
  3.  ABV          |    Double 		        | Alcohol by volume
  4.  IBU          |    Integer 		      | International Bitterness Units
  5.  Brewery_id   |    Integer 		      | Foreign key for brewery data set
  6.  Style        |    Character 			  | Beer type
  7.  Ounces       |    Double 			      | Number of ounces per serving



### Breweries

```{r head-breweries}

head(breweries)
# summary(breweries)
# str(breweries)

```

#### Data Dictionary

  Column Name      |Type                  |Description
  -----------------|--------------------- |------------------------------------------------
  1.  Brew_ID      |    Integer	          | Unique identifier for brewery
  2.  Name         |    Integer 		      | Brewery name
  3.  City         |    Character 		    | City of brewery
  4.  State        |    Character 		    | State of brewery


## Clone data sets

* Create a pristine copy of the originals so that further refinements of the columns names, values, etc.. can be performed

### Beers

```{r clone-and-transform-beers}

df_beers <- beers
colnames(df_beers)
names(df_beers) <- c("beer.name", "beer.id", "beer.abv", "beer.ibu", "beer.brewery.id", "beer.style", "beer.ounces")
head(df_beers)

```

### Breweries

```{r clone-and-transform-breweries}

df_breweries <- breweries
colnames(df_breweries)
names(df_breweries) <- c("brewery.id", "brewery.name", "brewery.city", "brewery.state.abb")

# The state column has an extra white space at the end of the string
df_breweries <- df_breweries %>%
  mutate(brewery.state.abb = trimws(brewery.state.abb))

head(df_breweries)

```

## State Lookup

- Washington D.C. added as an entry

```{r state-lookup}
#makes a data frame with State abbreviation, name  and region
df_state_lookup = data.frame(state.abb, state.name, state.region, stringsAsFactors=FALSE) 
# df_state_lookup

# add the District of Columbia as a lookup value
df_state_lookup <- rbind(df_state_lookup, 'DC' = c("DC", "Washington D.C.", "South"))
df_state_lookup


```



## Brewery Count by State

1.  How many breweries are present in each state?

* Note that all 50 states have counts and that the District of Columbia is also included to make a total of 51

```{r brewery-count}

df_breweries_state <- merge(df_breweries, df_state_lookup, by.x = "brewery.state.abb", by.y = "state.abb", all.x = TRUE)

# df_breweries_state

df_breweries_count_by_state <- df_breweries_state %>%
  count(state.name, sort = TRUE, name = "count")

kable(df_breweries_count_by_state) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))


```


```{r merge-beer-breweries}

df_merged <- merge(df_beers, df_breweries_state, by.x = "beer.brewery.id", by.y = "brewery.id")
# df_merged

```



## Merge beer and breweries

2.  Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)


### First 6 observations of merged data sets
```{r merged-head}

head(df_merged)

```

### Last 6 observations of merged data sets

```{r merged-tail}

tail(df_merged)


```


## Missing Values

3.   Address the missing values in each column.

* The ABV and IBU columns have missing values

- 62 for ABV
- 1005 for IBU (this is a very high percentage of the overall rows)

```{r merged-missing-values}

df_has_na_values <- any(is.na(df_merged))
df_has_na_values

# which columns have missing values
df_na_columns = which(colSums(is.na(df_merged)) > 0)
df_na_columns

df_na_abv <- df_merged %>%
  filter(is.na(beer.abv))

na_abv_count <- dim(df_na_abv)[1]

df_na_ibu <- df_merged %>%
  filter(is.na(beer.ibu))

na_ibu_count <- dim(df_na_ibu)[1]

total_count <- dim(df_merged)[1]

```

  Column Name      |Count                 |% Missing
  -----------------|--------------------- |------------------------------------------------
  1.  ABV          |    `r na_abv_count`	| `r na_abv_count / total_count * 100`
  2.  IBU          |    `r na_ibu_count`	| `r na_ibu_count / total_count * 100`


## Barplot of median values

4.   Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

### ABV

```{r merged-median-abv-barplot}

# df_merged_abv_clean <- df_merged %>%
#   filter(!is.na(beer.abv)) %>%
#   group_by(state.name) %>%
#   summarize(beers.abv.median = median(beer.abv), count = n()) %>%
#   arrange(desc(beers.abv.median))

# head(df_merged_abv_clean)

# df_merged_abv_clean %>%
#   ggplot(aes(x = reorder(state.name, -beers.abv.median), y=as.numeric(beers.abv.median))) +
#   geom_bar(stat = "identity", position = "dodge") +
#   ggtitle("Bar Plot of median ABV per State") +
#   labs(x = "State", y = "Median") +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1))

df_merged %>%
  select(state.name, beer.abv) %>%
  remove_missing(na.rm = TRUE) %>%
  group_by(state.name) %>%
  mutate(beers.abv.median = median(beer.abv)) %>%
  ggplot(aes(x = reorder(state.name, -beers.abv.median), y=beers.abv.median)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Bar Plot of median ABV per State") +
  labs(x = "State", y = "Median") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```


### IBU

```{r merged-median-ibu-barplot}

# df_merged_ibu_clean <- df_merged %>%
#   filter(!is.na(beer.ibu)) %>%
#   group_by(state.name) %>%
#   summarize(beers.ibu.median = median(beer.ibu), count = n()) %>%
#   arrange(desc(beers.ibu.median))

# head(df_merged_ibu_clean)

# df_merged_ibu_clean %>%
#   ggplot(aes(x = reorder(state.name, -beers.ibu.median), y=as.numeric(beers.ibu.median))) +
#   geom_bar(stat = "identity", position = "dodge") +
#   ggtitle("Bar Plot of median IBU per State") +
#   labs(x = "State", y = "Median") +
#   theme(axis.text.x = element_text(angle = 90, hjust = 1))


df_merged %>%
  select(state.name, beer.ibu) %>%
  remove_missing(na.rm = TRUE) %>%
  group_by(state.name) %>%
  mutate(beers.ibu.median = median(beer.ibu)) %>%
  ggplot(aes(x = reorder(state.name, -beers.ibu.median), y=beers.ibu.median)) +
  geom_bar(stat = "identity", position = "dodge") +
  ggtitle("Bar Plot of median IBU per State") +
  labs(x = "State", y = "Median") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

```



## Highest Median Values

5a.  Which state has the maximum alcoholic (ABV) beer?   Colorado
5b.  Which state has the most bitter (IBU) beer?  Oregon

### ABV


```{r merged-median-abv-table}

### Measures of Center
df_merged_abv_max <- df_merged %>%
  filter(!is.na(beer.abv)) %>%
  group_by(state.name) %>%
  summarize(beers.abv.max = max(beer.abv), count = n()) %>%
  arrange(desc(beers.abv.max))

df_merged_abv_median <- df_merged %>%
  filter(!is.na(beer.abv)) %>%
  group_by(state.name) %>%
  summarize(beers.abv.median = median(beer.abv), count = n()) %>%
  arrange(desc(beers.abv.median))

df_merged_abv_mean <- df_merged %>%
  filter(!is.na(beer.abv)) %>%
  group_by(state.name) %>%
  summarize(beers.abv.mean = mean(beer.abv), count = n()) %>%
  arrange(desc(beers.abv.mean))

head(df_merged_abv_max)
head(df_merged_abv_median)
head(df_merged_abv_mean)

```

### IBU

```{r merged-median-ibu-table}
  
### Measures of Center
df_merged_ibu_max <- df_merged %>%
  filter(!is.na(beer.ibu)) %>%
  group_by(state.name) %>%
  summarize(beers.ibu.max = max(beer.ibu), count = n()) %>%
  arrange(desc(beers.ibu.max))

df_merged_ibu_median <- df_merged %>%
  filter(!is.na(beer.ibu)) %>%
  group_by(state.name) %>%
  summarize(beers.ibu.median = median(beer.ibu), count = n()) %>%
  arrange(desc(beers.ibu.median))

df_merged_ibu_mean <- df_merged %>%
  filter(!is.na(beer.ibu)) %>%
  group_by(state.name) %>%
  summarize(beers.ibu.mean = mean(beer.ibu), count = n()) %>%
  arrange(desc(beers.ibu.mean))


head(df_merged_ibu_max)
head(df_merged_ibu_median)
head(df_merged_ibu_mean)

```


## ABV Summaary

### Histogram

6.  Comment on the summary statistics and distribution of the ABV variable.

* The histogram is right-skewed with the majority of the beers falling between 0.05 and 0.067 % alcholol by volume.

```{r merged-median-abv-histogram}


df_merged_abv_cleaned <- df_merged %>%
  select(state.name, beer.abv) %>%
  remove_missing(na.rm = TRUE)

summary(df_merged_abv_cleaned)

abv_min <- min(df_merged_abv_cleaned$beer.abv)
abv_max <- max(df_merged_abv_cleaned$beer.abv)
abv_median <- median(df_merged_abv_cleaned$beer.abv)
abv_mean <- mean(df_merged_abv_cleaned$beer.abv)
abv_sd <- sd(df_merged_abv_cleaned$beer.abv)


df_merged_abv_cleaned %>%
  ggplot(aes(beer.abv)) +
  geom_histogram() +
  ggtitle("Histogram of median ABV per State") +
  labs(x = "Median", y = "Count") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))


```

### Summary Statistics

  ABV Statistic          |Value                 
  -----------------------|--------------------- 
  1.  Minimum            |    `r abv_min`	      
  2.  Maxiumum           |    `r abv_max`	      
  3.  Median             |    `r abv_median`	 
  4.  Mean               |    `r abv_mean`	     
  5.  Standard Deviation |    `r abv_sd`	     


```{r merged-median-abv-summary}

abv_min 
abv_max 
abv_median 
abv_mean 
abv_sd 

```


## ABV vs IBU

7.  Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.

- There appears to be a linear relationship between a beer's International Bitterness Units (IBU) and the Alcohol by volume (ABV).  The stronger a beer is, the more likely it is to rate higher on the bitterness scale.

### Scatterplot

```{r merged-median-abv-ibu-scatterplot}

df_merged %>%
  select(beer.abv, beer.ibu) %>%
  remove_missing(na.rm = TRUE) %>%
  ggplot(aes(x = beer.abv, y = beer.ibu)) + 
  ggtitle("Scatterplot of IBV by ABU") +
  geom_point(alpha = 0.3) + 
  labs(x = "ABV", y = "IBU") +
  # scale_x_continuous(breaks = seq(from = 0, to = 45, by = 2)) + 
  geom_smooth(method = 'lm')

```
